# Magnetic Leverless Controller (自作磁気接点レバーレス)

本プロジェクトは、磁気スイッチ（ホールセンサー）を採用した超低遅延・高機能な競技用レバーレスコントローラーの開発プロジェクトです。

卒業制作の一環として制作されており、進捗に合わせて随時コードやデータの更新を行います。

---

## 概要

従来の物理接点スイッチではなく、磁力による非接触検知を採用することで、物理的な摩耗を抑えつつ、ミリ単位での高度な入力制御を実現しています。

### 主な機能
- **ラピッドトリガー (Rapid Trigger):** 指の上げ下げに即座に反応する超高速入力を実現。
- **可変作動点 (Actuation Point):** 反応する深さを 0.1mm 単位でカスタマイズ可能。
- **Web Configurator:** 専用ソフト不要。ブラウザからリアルタイムに設定変更・モニタリングが可能。
- **SOCDクリーナー:** 競技ルールに準拠した同時押し処理（ニュートラル優先等）を実装。

---

## ハードウェア設計

設計データはすべて `PCB` フォルダ内に格納されています。

- **基板データ (PCB Design):** 回路図および基板発注用のガーバーデータ。
- **筐体データ (Acrylic Case):** レーザーカット用のアクリルパネル設計データ。

---

## 導入手順

### 1. ファームウェアの書き込み
1. [STM32CubeProgrammer](https://www.st.com/ja/development-tools/stm32cubeprog.html) をインストールします。
2. ST-Link等の書き込みデバッガを使用して、PCと基板を接続します。
3. 本リポジトリの最新の `Leverless_Controller.bin` ファイルを読み込みます。
4. `Start Programming` を実行してインストールを完了させてください。

### 2. 起動モードの選択
本デバイスには2つの動作モードがあります。

- **ゲームモード (通常起動):**
  そのままUSBを接続します。Windowsから「Xbox 360 Controller」として認識され、すぐにゲームで使用可能です。
- **設定モード (ボタン押下起動):**
  **UPボタン（または特定のボタン）を押しながら**USBを接続します。デバイスマネージャーで「Leverless Configurator」として認識され、ブラウザからの設定が可能になります。

### 3. Web Configurator による設定
1. 設定モードでデバイスをPCに接続します。
2. Google Chrome または Microsoft Edge で本リポジトリ同梱の `index.html` を開きます。
3. 「Connect Device」ボタンを押し、リストから該当するデバイスを選択します。
4. 画面上のビジュアライザーで各キーの動きを確認しながら、AP（作動点）やRT（感度）を調整してください。
5. 設定完了後、「Save to Device」を押すことでマイコン内部のFlashメモリに設定が永続保存されます。

---

## 開発状況
- [x] ホールセンサーによるアナログ値の取得
- [x] ラピッドトリガー・可変作動点アルゴリズムの実装
- [x] WebHID / WebUSB による設定ツールの構築
- [x] Flashメモリへの設定保存機能
- [ ] マクロ機能・プロファイル切り替え（予定）

---

## クレジット・参考元
本プロジェクトの制作にあたり、以下のプロジェクトを参考にさせていただきました。

- **参考元:** [kenyoshizoe/ember](https://github.com/kenyoshizoe/ember/tree/main/pcb/ember)

---

## ライセンス
[MIT License](LICENSE)

---
*本プロジェクトは卒業制作として開発されました。*

